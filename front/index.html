<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Plus Control</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script defer src="app.js"></script>
  </head>
  <body>
    <div id="toastContainer" class="toast-container"></div>
    
    <header class="topbar">
      <div class="brand">
        <div class="brand-mark">PC</div>
        <div>
          <p class="eyebrow">Plus Control</p>
          <h1>Dashboard</h1>
        </div>
      </div>
      <div class="topbar-actions">
        <span id="userDisplay" class="user-display"></span>
        <button
          id="reportToggleBtn"
          class="btn btn-ghost"
          type="button"
          aria-expanded="false"
        >
          Weekly Report
        </button>
        <button id="backupBtn" class="btn btn-ghost">Backup BD</button>
        <button id="logoutBtn" class="btn btn-ghost">Logout</button>
      </div>
    </header>

    <main class="container">
      <section class="stats">
        <article class="stat-card">
          <p class="stat-label">Total Items</p>
          <p id="statItems" class="stat-value">0</p>
          <p id="statItemsTrend" class="stat-trend"></p>
        </article>
        <article class="stat-card">
          <p class="stat-label">Total Units</p>
          <p id="statUnits" class="stat-value">0</p>
          <p id="statUnitsTrend" class="stat-trend"></p>
        </article>
        <article class="stat-card">
          <p class="stat-label">Low Stock</p>
          <p id="statLow" class="stat-value">0</p>
          <p id="statLowTrend" class="stat-trend"></p>
        </article>
        <article class="stat-card">
          <p class="stat-label">Inventory Value</p>
          <p id="statValue" class="stat-value">$0.00</p>
          <p id="statValueTrend" class="stat-trend"></p>
        </article>
      </section>

      <section class="panel alert-panel" id="lowStockPanel" hidden>
        <div class="panel-header">
          <div>
            <h2>⚠️ Low Stock Alert</h2>
            <p>Items below threshold</p>
          </div>
        </div>
        <div id="lowStockList" class="alert-items"></div>
      </section>

      <section class="panel chart-panel">
        <div class="panel-header">
          <h2>Sales Analytics</h2>
        </div>
        <div class="chart-grid">
          <div class="chart-container">
            <h3>Weekly Sales</h3>
            <canvas id="salesChart"></canvas>
          </div>
          <div class="chart-container">
            <h3>Top 5 Products</h3>
            <canvas id="topProductsChart"></canvas>
          </div>
        </div>
      </section>

      <div id="weeklyDash" class="report-dash is-collapsed">
        <section class="panel report-panel">
          <div class="panel-header">
            <div>
              <h2>Weekly Report</h2>
              <p id="weeklyRange">Week of --</p>
            </div>
            <div class="filter-actions">
              <button
                id="reportPrintBtn"
                class="btn btn-ghost"
                type="button"
              >
                Imprimir
              </button>
              <button
                id="reportBackBtn"
                class="btn btn-ghost"
                type="button"
              >
                Volver
              </button>
            </div>
          </div>
          <div class="report-grid">
            <div class="report-card">
              <p class="report-label">Total Sales</p>
              <p id="weeklyTotal" class="report-value">$0.00</p>
            </div>
            <div class="report-card">
              <p class="report-label">Orders</p>
              <p id="weeklyCount" class="report-value">0</p>
            </div>
            <div class="report-card">
              <p class="report-label">Units</p>
              <p id="weeklyUnits" class="report-value">0</p>
            </div>
          </div>
          <div class="report-breakdown">
            <p class="report-label">By payment method</p>
            <div id="weeklyByPayment" class="report-list"></div>
          </div>
        </section>
      </div>

      <section class="panel form-panel">
        <div class="panel-header">
          <div>
            <h2>Add Item</h2>
            <p>Register a new product in inventory.</p>
          </div>
        </div>
        <form id="itemForm" class="form-grid" autocomplete="off">
          <input type="hidden" id="itemId" />
          <label>
            Name
            <input id="name" name="name" type="text" required />
          </label>
          <label>
            SKU
            <input id="sku" name="sku" type="text" required />
          </label>
          <label>
            Quantity
            <input id="quantity" name="quantity" type="number" min="0" required />
          </label>
          <label>
            Location
            <input id="location" name="location" type="text" required />
          </label>
          <label>
            Unit Price
            <input id="price" name="price" type="number" min="0" step="0.01" required />
          </label>
          <label>
            Low Stock Threshold
            <input
              id="threshold"
              name="threshold"
              type="number"
              min="0"
              value="5"
              required
            />
          </label>
          <div class="form-actions">
            <button type="submit" class="btn btn-primary" id="saveBtn">
              Save Item
            </button>
            <button type="button" class="btn btn-ghost" id="cancelEdit" hidden>
              Cancel Edit
            </button>
          </div>
        </form>
      </section>

      <section class="panel table-panel">
        <div class="panel-header">
          <div>
            <h2>Inventory</h2>
            <p>View and manage all items.</p>
          </div>
          <div class="filter-actions">
            <input
              id="search"
              class="input"
              type="search"
              placeholder="Search by name or SKU"
            />
            <label class="toggle">
              <input id="lowOnly" type="checkbox" />
              <span>Low stock</span>
            </label>
            <select id="sortBy" class="input">
              <option value="updated">Newest</option>
              <option value="name">Name (A-Z)</option>
              <option value="quantity">Qty (High-Low)</option>
              <option value="value">Value (High-Low)</option>
            </select>
          </div>
        </div>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Name</th>
                <th>SKU</th>
                <th>Qty</th>
                <th>Location</th>
                <th>Price</th>
                <th>Updated</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="inventoryBody"></tbody>
          </table>
        </div>
      </section>

      <section class="panel table-panel">
        <div class="panel-header">
          <div>
            <h2>Sales</h2>
            <p>Register and review sales.</p>
          </div>
          <div class="filter-actions">
            <button
              id="salesToggleBtn"
              class="btn btn-primary"
              type="button"
              aria-expanded="false"
            >
              Agregar venta
            </button>
          </div>
        </div>
      </section>

      <div id="salesDash" class="sales-dash is-collapsed">
        <section class="panel form-panel">
          <div class="panel-header">
            <div>
              <h2>Register Sale</h2>
              <p>Record a sale and deduct from inventory.</p>
            </div>
            <div class="filter-actions">
              <button
                id="salesBackBtn"
                class="btn btn-ghost"
                type="button"
              >
                Volver
              </button>
            </div>
          </div>
          <form id="saleForm" class="form-grid" autocomplete="off">
            <label>
              Product
              <select id="saleItemId" required>
                <option value="">-- Select a product --</option>
              </select>
            </label>
            <label>
              Unit Price
              <input id="salePriceInput" type="number" min="0" step="0.01" required />
            </label>
            <label>
              Quantity to Sell
              <input id="saleQuantity" type="number" min="1" value="1" required />
            </label>
            <label>
              Payment Method
              <select id="salePaymentMethod" required>
                <option value="">-- Select payment method --</option>
                <option value="Efectivo">Efectivo</option>
                <option value="Yappy">Yappy</option>
              </select>
            </label>
            <label>
              Total
              <input id="saleTotalInput" type="number" min="0" step="0.01" required />
            </label>
            <div class="form-actions">
              <button type="submit" class="btn btn-primary">Register Sale</button>
            </div>
            <p id="saleError" class="form-hint" aria-live="polite"></p>
          </form>
        </section>

        <section class="panel table-panel">
          <div class="panel-header">
            <div>
              <h2>Sales History</h2>
              <p>View all recorded sales.</p>
            </div>
            <div class="filter-actions">
              <input
                id="salesSearch"
                class="input"
                type="search"
                placeholder="Search product"
              />
              <select id="salesPaymentFilter" class="input">
                <option value="">All payments</option>
                <option value="Efectivo">Efectivo</option>
                <option value="Yappy">Yappy</option>
              </select>
            </div>
          </div>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Product</th>
                  <th>Qty</th>
                  <th>Unit Price</th>
                  <th>Total</th>
                  <th>Payment</th>
                  <th>Date</th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="salesBody"></tbody>
            </table>
          </div>
        </section>
      </div>

      <section class="panel table-panel">
        <div class="panel-header">
          <div>
            <h2>Finanzas</h2>
            <p>Control de inversión, costos y ganancias.</p>
          </div>
          <div class="filter-actions">
            <button
              id="financeToggleBtn"
              class="btn btn-primary"
              type="button"
              aria-expanded="false"
            >
              Agregar Inversión
            </button>
          </div>
        </div>
      </section>

      <div id="financeDash" class="finance-dash is-collapsed">
        <section class="panel form-panel">
          <div class="panel-header">
            <div>
              <h2>Investment & Purchases</h2>
              <p>Register initial capital and product costs.</p>
            </div>
            <div class="filter-actions">
              <button
                id="financeBackBtn"
                class="btn btn-ghost"
                type="button"
              >
                Volver
              </button>
            </div>
          </div>

          <div class="finance-forms">
            <form id="capitalForm" class="form-grid" autocomplete="off">
              <label>
                Initial Capital ($)
                <input id="capitalInput" type="number" min="0" step="0.01" required />
              </label>
              <div class="form-actions">
                <button type="submit" class="btn btn-primary">Save Capital</button>
              </div>
              <p id="capitalError" class="form-hint" aria-live="polite"></p>
            </form>

            <form id="purchaseForm" class="form-grid" autocomplete="off">
              <label>
                Product
                <select id="purchaseItemId" required>
                  <option value="">-- Select a product --</option>
                </select>
              </label>
              <label>
                Quantity Purchased
                <input id="purchaseQuantity" type="number" min="1" value="1" required />
              </label>
              <label>
                Unit Cost ($)
                <input id="purchaseCostUnit" type="number" min="0" step="0.01" required />
              </label>
              <label>
                Total Cost ($)
                <input id="purchaseTotalCost" type="number" min="0" step="0.01" readonly />
              </label>
              <div class="form-actions">
                <button type="submit" class="btn btn-primary">Register Purchase</button>
              </div>
              <p id="purchaseError" class="form-hint" aria-live="polite"></p>
            </form>
          </div>

          <div class="purchases-list">
            <h3>Purchase History</h3>
            <div id="purchasesContainer" class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>Product</th>
                    <th>Qty</th>
                    <th>Unit Cost</th>
                    <th>Total Cost</th>
                    <th>Date</th>
                  </tr>
                </thead>
                <tbody id="purchasesBody"></tbody>
              </table>
            </div>
          </div>
        </section>

        <section class="panel form-panel">
          <div class="panel-header">
            <div>
              <h2>Financial Summary</h2>
              <p>Real-time profit and capital tracking.</p>
            </div>
          </div>

          <div class="finance-summary">
            <div class="finance-card">
              <p class="finance-label">Initial Capital</p>
              <p id="financeInitialCapital" class="finance-value">$0.00</p>
            </div>
            <div class="finance-card">
              <p class="finance-label">Total Invested</p>
              <p id="financeTotalInvested" class="finance-value">$0.00</p>
            </div>
            <div class="finance-card">
              <p class="finance-label">Total Gain</p>
              <p id="financeTotalGain" class="finance-value">$0.00</p>
            </div>
            <div class="finance-card">
              <p class="finance-label">Current Capital</p>
              <p id="financeCapitalActual" class="finance-value">$0.00</p>
            </div>
            <div class="finance-card">
              <p class="finance-label">Profit Margin</p>
              <p id="financeMargin" class="finance-value">0%</p>
            </div>
            <div class="finance-card">
              <p class="finance-label">Today's Gain</p>
              <p id="financeGainToday" class="finance-value">$0.00</p>
            </div>
            <div class="finance-card">
              <p class="finance-label">Weekly Gain</p>
              <p id="financeGainWeek" class="finance-value">$0.00</p>
            </div>
            <div class="finance-card">
              <p class="finance-label">Monthly Gain</p>
              <p id="financeGainMonth" class="finance-value">$0.00</p>
            </div>
          </div>
        </section>
      </div>
    </main>
  </body>
</html>
